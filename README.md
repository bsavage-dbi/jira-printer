#Ugliest code ever seen, but it works.
